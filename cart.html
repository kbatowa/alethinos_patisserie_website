<!doctype html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#6b2bd1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Alethinos">
<link rel="manifest" href="./manifest.json">
<link rel="apple-touch-icon" href="./icons/icon-192.png">
<link rel="stylesheet" href="./app.css">
<title>Panier â€” Alethinos</title>
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <div class="brand-left">
        <img src="./assets/logo.png" alt="Logo Alethinos" class="brand-logo">
        <div class="brand-text">
          <h1>ğŸ§º Panier</h1>
        <div class="mini">Ajustez vos quantitÃ©s. Quand câ€™est bon â†’ paiement.</div>
              </div>
      </div>
      <a class="pill" href="./menu.html">ğŸ• Menu</a>
    </div>
  </div>

  <div class="container">
    <div id="list"></div>
    <div class="hr"></div>
    <div class="row">
      <div class="price" style="font-size:18px;">Total</div>
      <div class="price" id="total" style="font-size:18px;"></div>
    </div>

    <div class="hr"></div>

    <button class="btn secondary" onclick="location.href='./menu.html'">Continuer les achats</button>
    <button class="btn" id="checkoutBtn">Finaliser & passer au paiement</button>
    <button class="btn secondary" id="clearBtn" style="margin-top:8px;">Vider le panier</button>
  </div>

  <div class="cartbar" id="cartbar">
  <div class="inner" role="button" tabindex="0" onclick="location.href='./cart.html'">
    <div><strong>Voir le panier</strong> <span class="badge" data-cart-badge></span></div>
    <div><span id="cartbarTotal"></span></div>
  </div>
</div>
  <div class="navbar">
  <div class="inner">
    <a class="navlink" href="./menu.html"><div class="navicon">ğŸ•</div>Menu</a>
    <a class="navlink active" href="./cart.html"><div class="navicon">ğŸ§º</div>Panier <span class="badge" data-cart-badge></span></a>
    <a class="navlink" href="./order.html"><div class="navicon">ğŸ›µ</div>Commander</a>
    <a class="navlink" href="./index.html#infos"><div class="navicon">ğŸ“</div>Infos</a>
  </div>
</div>
  <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./sw.js");
  }
</script>
<script type="module">
  import { updateCartBadges, updateCartBar } from "./cart.js";
  window.addEventListener("DOMContentLoaded", () => { updateCartBadges(); updateCartBar(); });
</script>

  <script type="module">
    import { getCart, updateQty, cartTotal, formatFCFA, clearCart, cartCount, updateCartBadges, updateCartBar } from "./cart.js";

    const list = document.getElementById("list");
    const totalEl = document.getElementById("total");
    const checkoutBtn = document.getElementById("checkoutBtn");

    function render(){
      const cart = getCart();
      list.innerHTML = "";

      if (cart.length === 0){
        list.innerHTML = `<div class="notice"><strong>Panier vide.</strong><br>Retournez au menu pour ajouter des articles.</div>`;
        totalEl.textContent = formatFCFA(0);
        checkoutBtn.disabled = true;
        checkoutBtn.style.opacity = .55;
        updateCartBadges(); updateCartBar();
        return;
      }

      cart.forEach(item=>{
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <strong>${item.name}</strong>
          <div class="desc">${formatFCFA(item.price)} / unitÃ©</div>
          <div class="meta">
            <div class="row" style="gap:8px;">
              <span class="mini">QtÃ©</span>
              <input class="input" style="width:96px;" type="number" min="0" value="${item.qty}" data-id="${item.id}">
            </div>
            <div class="price">${formatFCFA(item.price * item.qty)}</div>
          </div>
        `;
        list.appendChild(div);
      });

      list.querySelectorAll("input[type='number']").forEach(inp=>{
        inp.addEventListener("change", ()=>{ updateQty(inp.dataset.id, inp.value); render(); });
      });

      totalEl.textContent = formatFCFA(cartTotal());
      checkoutBtn.disabled = cartCount() === 0;
      checkoutBtn.style.opacity = checkoutBtn.disabled ? .55 : 1;

      updateCartBadges(); updateCartBar();
    }

    document.getElementById("clearBtn").addEventListener("click", ()=>{ clearCart(); render(); });
    checkoutBtn.addEventListener("click", ()=>location.href="./checkout.html");
    render();
  </script>
</body>
</html>
